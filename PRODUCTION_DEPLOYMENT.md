# ðŸš€ Production Deployment Guide

## Overview

This guide will help you deploy ShopiBot to production, giving you a stable URL and eliminating the need to update proxy URLs every time you restart development.

---

## ðŸ“‹ Deployment Options

We'll cover three popular hosting platforms:

1. **Railway** (Recommended) - Easiest, auto-deploys from GitHub
2. **Render** - Free tier available, good alternative
3. **Heroku** - Reliable, well-documented

---

## ðŸŽ¯ Option 1: Railway (Recommended)

Railway is the easiest option with GitHub integration and automatic deploys.

### **Prerequisites**

- GitHub account with your code pushed
- Railway account (sign up at [railway.app](https://railway.app))
- Shopify Partner account

### **Step 1: Create Railway Project**

1. Go to [railway.app](https://railway.app)
2. Click "Start a New Project"
3. Select "Deploy from GitHub repo"
4. Authorize Railway to access your GitHub
5. Select your `shopibot-` repository
6. Click "Deploy Now"

### **Step 2: Configure Environment Variables**

In Railway dashboard:

1. Click your project
2. Go to "Variables" tab
3. Add these environment variables:

```env
# Shopify Configuration
SHOPIFY_API_KEY=your_shopify_api_key_here
SHOPIFY_SALES_ASSISTANT_WIDGET_ID=your_widget_id_here

# OpenAI (for AI features)
OPENAI_API_KEY=sk-your-openai-api-key-here

# N8N (optional)
N8N_WEBHOOK_URL=your_n8n_webhook_url_here
N8N_API_KEY=your_n8n_api_key_here

# Database URL (Railway provides this automatically)
# DATABASE_URL will be auto-generated by Railway

# Node Environment
NODE_ENV=production
```

### **Step 3: Configure Build Settings**

Railway auto-detects Node.js apps, but verify:

**Build Command:**
```bash
npm install && npm run setup && npm run build
```

**Start Command:**
```bash
npm start
```

**Root Directory:**
```
/
```

### **Step 4: Add Database**

1. In Railway dashboard, click "New"
2. Select "Database" â†’ "PostgreSQL" (recommended for production)
3. Railway will automatically:
   - Create database
   - Set `DATABASE_URL` environment variable
   - Link to your app

### **Step 5: Update Prisma for PostgreSQL**

Update `prisma/schema.prisma`:

```prisma
datasource db {
  provider = "postgresql"  // Changed from "sqlite"
  url      = env("DATABASE_URL")
}
```

Commit and push:
```bash
git add prisma/schema.prisma
git commit -m "Switch to PostgreSQL for production"
git push
```

Railway will auto-deploy!

### **Step 6: Get Your Production URL**

1. In Railway dashboard, click "Settings"
2. Scroll to "Domains"
3. Click "Generate Domain"
4. Your URL will be: `https://your-app-name.up.railway.app`

### **Step 7: Configure Shopify Partner Dashboard**

1. Go to [Shopify Partner Dashboard](https://partners.shopify.com)
2. Navigate to Apps â†’ Your App â†’ App setup
3. Update these URLs:

**App URL:**
```
https://your-app-name.up.railway.app
```

**Allowed redirection URLs:**
```
https://your-app-name.up.railway.app/auth/callback
https://your-app-name.up.railway.app/auth/shopify/callback
https://your-app-name.up.railway.app/api/auth/callback
```

**App Proxy:**
- Subpath prefix: `apps`
- Subpath: `widget-settings`
- Proxy URL: `https://your-app-name.up.railway.app/api/widget-settings`

4. Save changes

### **Step 8: Update shopify.app.toml**

Update your local `shopify.app.toml`:

```toml
# Learn more about configuring your app at https://shopify.dev/docs/apps/tools/cli/configuration

name = "shopibot"
client_id = "your_client_id_here"
application_url = "https://your-app-name.up.railway.app"
embedded = true

[build]
automatically_update_urls_on_dev = false
dev_store_url = "your-dev-store.myshopify.com"

[access_scopes]
# Learn more at https://shopify.dev/docs/apps/tools/cli/configuration#access_scopes
scopes = "write_products"

[auth]
redirect_urls = [
  "https://your-app-name.up.railway.app/auth/callback",
  "https://your-app-name.up.railway.app/auth/shopify/callback",
  "https://your-app-name.up.railway.app/api/auth/callback"
]

[webhooks]
api_version = "2024-10"

[pos]
embedded = false
```

### **Step 9: Deploy & Test**

Railway automatically deploys when you push to GitHub!

**Test your deployment:**
1. Install app in your Shopify store
2. Navigate to Settings page
3. Test widget functionality
4. Check Analytics dashboard
5. Verify chat responses

### **Step 10: Generate Embeddings (Optional)**

SSH into Railway or run locally against production:

```bash
npm run generate-embeddings -- --shop=your-store.myshopify.com
```

---

## ðŸŽ¨ Option 2: Render

Render offers a free tier and is very reliable.

### **Step 1: Create Render Account**

1. Go to [render.com](https://render.com)
2. Sign up with GitHub
3. Click "New +" â†’ "Web Service"
4. Connect your GitHub repository

### **Step 2: Configure Service**

**Name:** `shopibot`

**Region:** Choose closest to your users

**Branch:** `main` or your production branch

**Runtime:** `Node`

**Build Command:**
```bash
npm install && npx prisma generate && npx prisma migrate deploy && npm run build
```

**Start Command:**
```bash
npm start
```

### **Step 3: Add Environment Variables**

In Render dashboard, add:

```env
SHOPIFY_API_KEY=your_api_key
SHOPIFY_SALES_ASSISTANT_WIDGET_ID=your_widget_id
OPENAI_API_KEY=sk-your-openai-key
N8N_WEBHOOK_URL=your_n8n_url
N8N_API_KEY=your_n8n_key
NODE_ENV=production
```

### **Step 4: Add PostgreSQL Database**

1. Click "New +" â†’ "PostgreSQL"
2. Name it `shopibot-db`
3. Choose free tier or paid
4. Copy the "Internal Database URL"
5. Add to web service as `DATABASE_URL`

### **Step 5: Deploy**

1. Click "Create Web Service"
2. Render will build and deploy
3. Get your URL: `https://shopibot.onrender.com`

### **Step 6: Configure Shopify**

Follow same steps as Railway (Step 7 above) using your Render URL.

---

## ðŸŸ£ Option 3: Heroku

Heroku is a classic choice with excellent documentation.

### **Step 1: Install Heroku CLI**

```bash
npm install -g heroku
heroku login
```

### **Step 2: Create Heroku App**

```bash
cd /path/to/shopibot-
heroku create your-shopibot-app
```

### **Step 3: Add PostgreSQL**

```bash
heroku addons:create heroku-postgresql:mini
```

This automatically sets `DATABASE_URL`.

### **Step 4: Set Environment Variables**

```bash
heroku config:set SHOPIFY_API_KEY=your_api_key
heroku config:set SHOPIFY_SALES_ASSISTANT_WIDGET_ID=your_widget_id
heroku config:set OPENAI_API_KEY=sk-your-openai-key
heroku config:set N8N_WEBHOOK_URL=your_n8n_url
heroku config:set N8N_API_KEY=your_n8n_key
heroku config:set NODE_ENV=production
```

### **Step 5: Create Procfile**

Create `Procfile` in root:

```
web: npm start
release: npx prisma migrate deploy
```

### **Step 6: Deploy**

```bash
git add .
git commit -m "Prepare for Heroku deployment"
git push heroku main
```

### **Step 7: Configure Shopify**

Use your Heroku URL: `https://your-shopibot-app.herokuapp.com`

Follow same steps as Railway (Step 7).

---

## ðŸ”§ Post-Deployment Configuration

### **Update Local Development**

Keep local `shopify.app.toml` for development, but add production config:

```toml
[environments.production]
application_url = "https://your-production-url.com"
```

### **SSL Certificate**

All platforms provide free SSL automatically:
- âœ… Railway: Automatic
- âœ… Render: Automatic
- âœ… Heroku: Automatic

### **Custom Domain (Optional)**

#### **Railway:**
1. Go to Settings â†’ Domains
2. Click "Custom Domain"
3. Add your domain: `shopibot.yourdomain.com`
4. Add CNAME record in your DNS:
   ```
   CNAME shopibot -> your-app.up.railway.app
   ```

#### **Render:**
1. Go to Settings â†’ Custom Domains
2. Add your domain
3. Add CNAME record in DNS

#### **Heroku:**
```bash
heroku domains:add shopibot.yourdomain.com
```
Then add CNAME in DNS.

---

## ðŸ—„ï¸ Database Migration

### **From SQLite to PostgreSQL**

Your data will NOT migrate automatically. Options:

#### **Option 1: Start Fresh**
```bash
# Already done by Railway/Render/Heroku
npx prisma migrate deploy
```

#### **Option 2: Export/Import Data**

**Export from SQLite:**
```bash
# Install sqlite3
npm install -g sqlite3

# Export data
sqlite3 prisma/dev.sqlite .dump > backup.sql
```

**Import to PostgreSQL:**
```bash
# Connect to production DB
psql $DATABASE_URL < backup.sql
```

---

## ðŸ“Š Monitoring & Logs

### **Railway Logs**

```bash
# Install Railway CLI
npm i -g @railway/cli

# View logs
railway logs
```

Or view in dashboard: Deployments â†’ Click deployment â†’ Logs

### **Render Logs**

View in dashboard: Logs tab (real-time)

### **Heroku Logs**

```bash
heroku logs --tail
```

---

## ðŸ” Troubleshooting

### **Issue: Build fails**

**Check:**
- All environment variables set
- `package.json` scripts correct
- Prisma migrations work

**Solution:**
```bash
# Test locally first
NODE_ENV=production npm run build
```

### **Issue: Database connection fails**

**Check:**
- `DATABASE_URL` is set
- Prisma schema uses PostgreSQL
- Migrations ran successfully

**Solution:**
```bash
# Railway/Render/Heroku dashboard
# Verify DATABASE_URL format:
postgresql://user:password@host:5432/database
```

### **Issue: App proxy not working**

**Check:**
- Proxy URL in Shopify Partner Dashboard
- URL includes `/api/widget-settings`
- App is deployed and running

**Test:**
```bash
curl https://your-app.railway.app/api/widget-settings?shop=test.myshopify.com
```

### **Issue: Embeddings not working**

**Check:**
- `OPENAI_API_KEY` is set
- Key is valid
- Prisma database includes ProductEmbedding table

**Solution:**
```bash
# Run migration
npx prisma migrate deploy

# Generate embeddings
npm run generate-embeddings -- --shop=your-store.myshopify.com
```

---

## âœ… Deployment Checklist

- [ ] Choose hosting platform (Railway/Render/Heroku)
- [ ] Create account and project
- [ ] Configure environment variables
- [ ] Add PostgreSQL database
- [ ] Update Prisma schema for PostgreSQL
- [ ] Deploy application
- [ ] Get production URL
- [ ] Update Shopify Partner Dashboard
  - [ ] App URL
  - [ ] Redirect URLs
  - [ ] App Proxy URL
- [ ] Update shopify.app.toml
- [ ] Test app installation
- [ ] Test widget functionality
- [ ] Test analytics dashboard
- [ ] Generate product embeddings
- [ ] Monitor logs for errors
- [ ] Set up custom domain (optional)

---

## ðŸ’° Cost Comparison

| Platform | Free Tier | Paid Tier | Database |
|----------|-----------|-----------|----------|
| **Railway** | $5 credit/month | $5/month | PostgreSQL included |
| **Render** | 750 hours/month | $7/month | PostgreSQL $7/month |
| **Heroku** | None (was free) | $7/month | PostgreSQL $5/month |

**Recommendation:** Railway for best value and ease of use.

---

## ðŸš€ Quick Start (Railway)

The fastest way to deploy:

```bash
# 1. Push code to GitHub
git add .
git commit -m "Ready for production"
git push

# 2. Go to railway.app
# 3. Click "Deploy from GitHub"
# 4. Select your repo
# 5. Add environment variables
# 6. Wait for deploy (2-3 minutes)
# 7. Get your URL
# 8. Update Shopify Partner Dashboard
# 9. Done!
```

---

## ðŸ“š Additional Resources

- [Railway Docs](https://docs.railway.app/)
- [Render Docs](https://render.com/docs)
- [Heroku Docs](https://devcenter.heroku.com/)
- [Shopify App Deployment](https://shopify.dev/docs/apps/deployment)
- [Prisma Deployment](https://www.prisma.io/docs/guides/deployment)

---

## ðŸ†˜ Need Help?

**Common Issues:**
- Proxy URL not working â†’ Check Shopify Partner Dashboard
- Database errors â†’ Verify DATABASE_URL and run migrations
- Build fails â†’ Check logs and environment variables
- OpenAI errors â†’ Verify API key is set

**Support:**
- Check deployment logs first
- Review environment variables
- Test endpoints manually
- Open GitHub issue if needed

---

## ðŸŽ‰ Success!

Once deployed, you'll have:
- âœ… Stable production URL (no more tunnel URL changes!)
- âœ… Professional hosting
- âœ… Automatic SSL
- âœ… Easy scaling
- âœ… Continuous deployment from GitHub
- âœ… Production database
- âœ… Monitoring and logs

Your app is now production-ready! ðŸš€

---

**Next Steps:**
1. Monitor analytics dashboard
2. Generate embeddings for products
3. Test with real customers
4. Iterate based on feedback

---

**Version:** 2.0.0
**Last Updated:** November 2024
**Status:** âœ… Production Ready
